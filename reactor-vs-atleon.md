# Migrating from Reactor-Kafka + Spring-Kafka to Atleon-Kafka's Low Level API

## Coding Comparison

Hints: 
- It is important to know, that we came from using **Reactor-Kafka** (https://projectreactor.io/docs/kafka/release/reference/)
  **together** with **Spring-Kafka** (https://spring.io/projects/spring-kafka)! So we haven't used e.g. *reactor.kafka.receiver.KafkaReceiver*
  directly, but via the Spring abstraction *org.springframework.kafka.core.reactive.ReactiveKafkaConsumerTemplate*. Same for the Producer side.
- To keep the configuration **as-is** without re-using *Spring-Kafka* dependency, the configuration was partially rebuild using a
  [SpringKafkaProperties.java](src/main/java/com/giraone/kafka/pipeline/config/properties/SpringKafkaProperties.java) class.

| Context                        | reactor-kafka                                                                   | atleon-kafka                                                                                                      | Comment                                                                                              |
|:-------------------------------|:--------------------------------------------------------------------------------|:------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------|
| Maven GAV                      | `io.projectreactor.kafka:reactor-kafka:1.3.24`                                  | `io.atleon:atleon-kafka:0.37.0`                                                                                   |                                                                                                      |
|                                | plus `org.springframework.kafka:spring-kafka:3.5.10`                            | plus `io.atleon:atleon-micrometer:0.37.0`                                                                         |                                                                                                      |
| Package                        | `reactor.kafka`                                                                 | `io.atleon.kafka`                                                                                                 |                                                                                                      |
| Sender Record                  | class `reactor.kafka.receiver.SenderRecord<K, V, T>`                            | class `io.atleon.kafka.KafkaSenderRecord<K, V, T>`                                                                |                                                                                                      |
| Receiver Record                | class `reactor.kafka.receiver.ReceiverRecord<K, V>`                             | class `io.atleon.kafka.KafkaReceiverRecord<K, V>`                                                                 | Reactor extends `org.apache.kafka.clients.consumer.ConsumerRecord`; Atleon contains `ConsumerRecord` |
| Receiver Record add. members   | `ReceiverOffset (TopicPartition, offset)`                                       |                                                                                                                   | Atleon has no ReceiverOffset; TopicPartition and offset cam be obtained from `ConsumerRecord`        |
| Sender Result                  | interface `reactor.kafka.sender.SenderResult<T>`                                | class `io.atleon.kafka.KafkaSenderResult<T>`                                                                      | Both contains generic correlation metadata                                                           |
| RecordMetaData of SenderResult | `RecordMetadata senderResult.recordMetadata()`                                  | `Optional<RecordMetadata> kafkaSenderResult.recordMetadata()`                                                     | Atleon uses Optional                                                                                 |
| SenderOptions                  | `SenderOptions<K, V> create(Map<String, Object> properties)`                    | `KafkaSenderOptions.<K,V>newBuilder(). ... .build()`                                                              |                                                                                                      |
| ReceiverOptions                | `ReceiverOptions<K, V> create(Map<String, Object> properties)`                  | `KafkaReceiverOptions.<K,V>newBuilder(). ... .build()`                                                            |                                                                                                      |
| receive method                 | `reactiveKafkaConsumerTemplate.receive()`                                       | `kafkaReceiver.receiveManual(topic)`                                                                              | receiveManual needs topic(s) as parameter                                                            |
| fetch partition count          | `reactiveKafkaProducerTemplate.partitionsFromProducerFor(String topic)`         | No counter part in Producer API.                                                                                  | Atleon has only `ReactiveAdmin.listTopicPartitions(List<String>)` from Admin API.                    |
| Metrics Producer               | `SenderOptions.producerListener(new MicrometerProducerListener(meterRegistry))` | `KafkaReceiverOptions.producerProperty(METRIC_REPORTER_CLASSES_CONFIG, AloKafkaMetricsReporter.class.getName());` |                                                                                                      |                                                                                                     | Different setup                                                                                      |
| Metrics Consumer               | `SenderOptions.consumerListener(new MicrometerConsumerListener(meterRegistry))` | `KafkaReceiverOptions.consumerProperty(METRIC_REPORTER_CLASSES_CONFIG, AloKafkaMetricsReporter.class.getName());` |                                                                                                      |                                                                                                     | Different setup                                                                                      |
| commits |                      | `senderResult.correlationMetadata().receiverOffset().commit()`                  | `kafkaSenderResult.correlationMetadata().acknowledge()`                                              |                                                                                                      |




